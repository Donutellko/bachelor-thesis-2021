%! suppress = Unicode


\chapter{ПРАКТИЧЕСКАЯ РЕАЛИЗАЦИЯ} \label{ch:ch2}

\textbf{Хорошим стилем является наличие введения к главе, которое \textit{начинается непосредственно после названия главы, без оформления в виде отдельного параграфа}.}


\section{Требования к реализации} \label{sec:requirements} %название по-русски

Реализация предлагаемой системы в рамках выпускной квалификационной работы должна обладать следующей функциональностью:

\begin{itemize}
    \item Загружать маппинги из источника, которым является git-репозиторий, ссылка на который указывается в настройках.

    \item Принимать REST-запросы, имеющие методы \texttt{GET}, \texttt{POST}, \texttt{PUT}, \texttt{DELETE}.

    \item Находить для запроса соответствующий маппинг по методу запроса и URI запроса.
    URI запроса, указанный в маппинге, может иметь \texttt{path variable}, то есть для следующего запроса

    \texttt{GET /api/users/123/accounts?currency=RUR}

    должен быть найден следующий маппинг:

    \texttt{GET /api/users/\#\{userId\}/accounts}

    \item Использовать \texttt{path variables}, \texttt{query params} и заголовки запроса в качестве переменных для формирования запроса по шаблону, указанному в маппинге.
    Так, в предыдущем примере на основании запроса будут задаваться значения двух переменных: \texttt{userId=123} и \texttt{currency=RUR}.

    \item Также использовать тело для получения значений переменных.
    Например, при получении запроса со следующим телом

    \texttt{\{ "name": "Александров"\, "address": \{"street": "Лубянка"\, "house": "1" \}\}}

    будут получены значения переменных

    \texttt{name=Александров ; address.street=Лубянка ; address.house=1}

    \item Подставлять значения переменных в шаблон запроса, хранимый в маппинге, на место плейсхолдеров с соответствующий именем.
    Например, следующий запрос из маппинга:

    \texttt{\{ users(id: "\#\{userId\}")\{ accounts(currency\_eq: "\#{currency}") \{ number \} \}}

    должен быть заполнен следующим образом:

    \texttt{\{ users(id: "123")\{ accounts(currency\_eq: "RUR") \{ number \} \}}

    \item В случае, если маппинг не был найден, запрос должен быть в неизменном виде (с сохранением URI, \texttt{query params}, заголовков и тела запроса) направлен по адресу API Gateway, заданному в настройках.

    \item При наличии нескольких подходящих маппингов, выбирать более специфичный.
    Например, при наличии маппингов

    \texttt{GET /users/\#\{userId\}} и \texttt{GET /users/\#\{userId\}/accounts/\#\{accountId\}}

    при поступлении запроса

    \texttt{GET /users/123/accounts/456}

    должен быть использован второй маппинг.

    \item Осуществить преобразование полученного ответа осуществляется при наличии правила для преобразования в маппинге.
    Для преобразования используется технология, указанная в маппинге.
    Правила для осуществления преобразования задаются в соответствующем указанной технологии формате.
    Выбор поддерживаемых технологий осуществляется разработчиком.
\end{itemize}

Диаграмма, иллюстрирующая взаимодействие между клиентом и описываемым сервисом изображена в приложении 4.

\section{Выбор технологий}\label{sec:choose-technology}

Для системы, реализуемой в рамках выпускной квалификационной работы, в дальнейшем будет использоваться название R2G (Rest to GraphQL).

Для создания системы будет использован Spring Framework, являющийся одним из самых распространённых и мощных фреймворков для создания веб-сервисов.
Spring Framework включает в себя множество различных модулей, которые позволяют значительно ускорить разработку и уменьшить количество необходимого кода за счёт использования многочисленных дополнительных модулей.
В частности, будут использованы следующие модули:

\begin{itemize}
    \item Spring Boot позволяет подключать так называемые starters, которые включают в себя другие модули и упрощают их конфигурирование.
    \item Spring Web используется для создания эндпоинтов для обработки входящих REST-запросов.
    \item Spring Cloud Config для управления настройками сервиса, в частности для возможности получения настроек и маппингов из git-репозитория.
\end{itemize}

Spring Framework изначально разрабатывался для использования с языком Java, однако на данный момент поддерживает значительное число языков JVM, и в рамках данной работы будет использован язык Kotlin, имеющий среди преимуществ перед Java лаконичность и возможность использования корутин (легковесных потоков) для повышения производительности и упрощения использования реактивного подхода.

Для взаимодействия с GraphQL-сервисами существуют специальные библиотеки, как например Apollo Client, позволяющие упростить создание клиентских приложений за счёт генерации кода на основании схемы и GraphQL-запросов.
Однако подобный подход неприменим в данном случае, так как разрабатываемый сервис должен уметь работать с GraphQL-сервисами в общем случае.
Поэтому для обращения к GraphQL-сервисам будет использован обычный HTTP-клиент.

Для преобразования результатов используем технологию JOLT, так как она является достаточно мощной технологией, позволяющей осуществлять разнообразные манипуляции с JSON, позволяет писать юнит-тесты для проверки написанных преобразований, а также одной из немногих подобных технологий имеет реализацию в виде библиотеки для Java.


\section{Данные для тестирования реализации}\label{sec:testing-data}

Для тестирования сервиса R2G планируется использовать публичные GraphQL-сервисы.
В частности, сервис FakeQL позволяет создать GraphQL-сервис на основании данных в виде JSON. Для этого используем JSON, представленный в приложении 5.
Данный JSON загружается на сайт FakeQL, после чего мы получаем URL эндпоинта, к которому можно отправлять GraphQL-запросы.
Схема получившегося сервиса была продемонстрирована ранее (см.
приложение 1).

В приложении 6 продемонстрирован пример маппинга.
для получения списка счетов в валюте из query parameter, для пользователя с идентификатором, переданным в URI. В приложении 7 представлен пример запроса, который соответствует указанному маппингу, а также GraphQL-запрос, который должен быть отправлен в GraphQL-сервер при получении такого запроса.


\section{Выводы} \label{sec:conclusion-practive}

Параграф с изложением выводов по главе \textit{является обязательным}.